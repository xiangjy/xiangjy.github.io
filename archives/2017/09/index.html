
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Xiangjy&#39;s Blog">
    <title>归档: 2017/9 - Xiangjy&#39;s Blog</title>
    <meta name="author" content="Xiangjy">
    
    
        <link rel="icon" href="http://localhost:4000/assets/images/dx.png">
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="Xiangjy&#39;s Blog">
<meta property="og:url" content="http://localhost:4000/archives/2017/09/index.html">
<meta property="og:site_name" content="Xiangjy&#39;s Blog">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Xiangjy&#39;s Blog">
    
    
        
    
    
        <meta property="og:image" content="http://localhost:4000/assets/images/dx.png"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-c4ozcsklz4kht2pebhp44xorvyverh23toayhn7i6ubrpyedak24hv1v0hyd.min.css">
    <!--STYLES END--><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    

    
</head>

    <body>
        <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Xiangjy&#39;s Blog</a>
    </div>
    
        
            <a class="header-right-picture " href="#about">
        
        
            <img class="header-picture" src="/assets/images/dx.png" alt="作者的图片">
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/dx.png" alt="作者的图片">
                </a>
                <h4 class="sidebar-profile-name">Xiangjy</h4>
                
                    <h5 class="sidebar-profile-bio"><p>author.bio</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/ " title="首页">
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-categories" title="分类">
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-tags" title="标签">
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-archives" title="归档">
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link open-algolia-search" href="#search" title="搜索">
                    
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜索</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="#about" title="关于">
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://github.com/" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="http://stackoverflow.com/users" target="_blank" rel="noopener" title="Stack Overflow">
                    
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://twitter.com/" target="_blank" rel="noopener" title="Twitter">
                    
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://facebook.com/" target="_blank" rel="noopener" title="Facebook">
                    
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://plus.google.com/" target="_blank" rel="noopener" title="Google Plus">
                    
                        <i class="sidebar-button-icon fab fa-google-plus" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Google Plus</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://www.linkedin.com/profile/" target="_blank" rel="noopener" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/mailto" title="邮箱">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/atom.xml" title="RSS">
                    
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2017/09/19/algorithm/">
                            algorithm
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-09-19T15:42:24+08:00">
	
		    9月 19, 2017
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h4 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h4><p>将后面的元素插入前面已经排序好的序列中<br>循环每一个元素<br>从第二个元素开始循环，逆序与前面每一个元素比较(默认前面元素已经是排序好的)，如果小于则交换<br>[8, 7, 6, 5, 4, 3, 2, 1]<br>先选出7，逆序循环与前面排序好的[8]比较，小于交换<br>[7, 8, 6, 5, 4, 3, 2, 1]<br>选出6，逆序循环与前面排序好的[7,8]比较，小于交换<br>[7, 6, 8, 5, 4, 3, 2, 1]<br>[6, 7, 8, 5, 4, 3, 2, 1]<br>一次类推</p>
<h4 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h4><p>根据序列长度分组后，对每个组进行插入排序<br>循环对数组分组，分完的组进行插入排序<br>[8, 7, 6, 5, 4, 3, 2, 1]<br>根据长度分组len(L)/2 = 4, gap = 4<br>[L[0], L[0 + 4]], [L[1], L[1 + 4]…<br>[8, 4], [7, 3], [6, 2], [5, 1] -&gt; [4, 8], [3, 7], [2, 6], [1, 5]<br>[4,3,2,1,8,7,6,5]<br>gap /= 2<br>[L[0], L[0 + 2], L[0 + 4], L[0 + 6]]…<br>[4, 2, 8, 6] [3, 1, 7, 5] -&gt; [2, 4, 6, 8] [1, 3, 5, 7]<br>gap /= 2<br>[2, 1, 4, 3, 6, 5, 8, 7]<br>gap /= 2<br>[2, 1, 4, 3, 6, 5, 8, 7] -&gt; [1, 2, 3, 4, 5, 6, 7, 8]</p>
<h4 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h4><p>选择待排序子序列中最小值，最小值换到第一位置<br>[8, 7, 6, 5, 4, 3, 2, 1]<br>[1, 7, 6, 5, 4, 3, 2, 8]<br>[1, 2, 6, 5, 4, 3, 7, 8]<br>[1, 2, 3, 5, 4, 6, 7, 8]…</p>
<h4 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h4><h4 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h4><p>从第一个元素比较，将大的元素往后面移<br>[8, 7, 6, 5, 4, 3, 2, 1]<br>[7, 8, 6, 5, 4, 3, 2, 1]…<br>[7, 6, 5, 4, 3, 2, 1, 8]…</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2017/09/19/algorithm/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2017/09/19/HTML5 惊艳 demo/">
                            HTML5 惊艳 demo
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-09-19T15:42:24+08:00">
	
		    9月 19, 2017
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h4 id="HTML5-惊艳-demo"><a href="#HTML5-惊艳-demo" class="headerlink" title="HTML5 惊艳 demo"></a>HTML5 惊艳 demo</h4><p>链接：<a href="https://www.zhihu.com/question/24398907/answer/30239864" target="_blank" rel="noopener">https://www.zhihu.com/question/24398907/answer/30239864</a></p>
<p>来源：知乎</p>
<p>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<p>找不到之前所见过的网页，深有同感！<br><a href="https://link.zhihu.com/?target=http%3A//tympanus.net/Development/AnimatedBooks/" target="_blank" rel="noopener">Animated Books with CSS 3D Transforms</a>  这是一个3D书本，CSS3完成</p>
<p>=========HTML5特效聚集网站========<br><a href="https://link.zhihu.com/?target=http%3A//christmasexperiments.com/" target="_blank" rel="noopener">christmasexperiments.com 的页面</a><br><a href="https://link.zhihu.com/?target=http%3A//www.chromeexperiments.com/" target="_blank" rel="noopener">chromeexperiments.com 的页面</a><br><a href="https://link.zhihu.com/?target=http%3A//www.mrdoob.com/" target="_blank" rel="noopener">Mr.doob</a><br><a href="https://link.zhihu.com/?target=http%3A//litewerx.dk/" target="_blank" rel="noopener">litewerx.showcase</a><br><a href="https://link.zhihu.com/?target=http%3A//fff.cmiscm.com/%23%21/main" target="_blank" rel="noopener">Form Follows Function</a><br><a href="https://link.zhihu.com/?target=http%3A//alteredqualia.com/" target="_blank" rel="noopener">AlteredQualia</a><br><a href="https://link.zhihu.com/?target=http%3A//www.html5rocks.com/en/resources" target="_blank" rel="noopener">html5rocks.com 的页面</a></p>
<p>===========视觉特效与交互式视频============<br><a href="https://link.zhihu.com/?target=http%3A//www.thewildernessdowntown.com/" target="_blank" rel="noopener">http://www.thewildernessdowntown.com/</a><br><a href="https://link.zhihu.com/?target=http%3A//www.itsumokawaii.jp/en/" target="_blank" rel="noopener">Interactive Film “itsumo kawaii”</a><br><a href="https://link.zhihu.com/?target=http%3A//www.beonlineb.com/" target="_blank" rel="noopener">http://www.beonlineb.com/</a><br><a href="https://link.zhihu.com/?target=http%3A//www.justareflektor.com/" target="_blank" rel="noopener">Arcade Fire / Just a Reflektor</a><br><a href="https://link.zhihu.com/?target=http%3A//www.aaronkoblin.com/Aaronetrope/" target="_blank" rel="noopener">Aaronetrope</a>  3D科幻视频投影对话<br><a href="https://link.zhihu.com/?target=http%3A//aleksandarrodic.com/" target="_blank" rel="noopener">Aleksandar Rodic</a> 3D立体博客<br><a href="https://link.zhihu.com/?target=http%3A//inear.se/beanstalk/" target="_blank" rel="noopener">Beanstalk</a><br><a href="https://link.zhihu.com/?target=http%3A//www.ro.me/" target="_blank" rel="noopener">http://www.ro.me/</a><br><a href="https://link.zhihu.com/?target=http%3A//alteredqualia.com/three/examples/webgl_terrain_dynamic.html" target="_blank" rel="noopener">three.js webgl</a> 动态地图<br><a href="https://link.zhihu.com/?target=http%3A//ogreen.special-t.com/en/" target="_blank" rel="noopener">Ô Green by SPECIAL.T</a> 水中植物广告<br><a href="https://link.zhihu.com/?target=http%3A//kimatica.net/%23/leafs/" target="_blank" rel="noopener">Kimatica - Creative Connections</a> 树脉<br><a href="https://link.zhihu.com/?target=http%3A//callhimecho.com/%23" target="_blank" rel="noopener">Earth to Echo</a> 电影科幻宣传网站<br><a href="https://link.zhihu.com/?target=http%3A//middle-earth.thehobbit.com/map" target="_blank" rel="noopener">http://middle-earth.thehobbit.com/map</a> 霍比特人<br><a href="https://link.zhihu.com/?target=http%3A//hellorun.helloenjoy.com/" target="_blank" rel="noopener">HelloRun™</a>  线稿房间，第一人称动<br><a href="https://link.zhihu.com/?target=http%3A//letters-inc.jp/%3Ft%3Dd" target="_blank" rel="noopener">LETTERS, INC.</a> 集成电路<br><a href="https://link.zhihu.com/?target=http%3A//dataveyes.com/%23%21/en" target="_blank" rel="noopener">Dataveyes | Human Data Interactions</a> 视觉粒子</p>
<p>=========音乐与可视化==========<br><a href="https://link.zhihu.com/?target=http%3A//do.adive.in/" target="_blank" rel="noopener">http://do.adive.in/</a><br><a href="https://link.zhihu.com/?target=http%3A//www.clicktorelease.com/code/rocking-dendrites/" target="_blank" rel="noopener">Rocking dendrites</a> 摇滚与触手<br><a href="https://link.zhihu.com/?target=http%3A//jabtunes.com/labs/arabesque/" target="_blank" rel="noopener">Arabesque - Music Colour Particles</a> 优美的纯音乐与彩色烟雾<br><a href="https://link.zhihu.com/?target=http%3A//blackpawn.com/demos/vrtx-01-compo-filler/" target="_blank" rel="noopener">compo.filler</a>  蓝电之音<br><a href="https://link.zhihu.com/?target=http%3A//lights.helloenjoy.com/" target="_blank" rel="noopener">Lights</a> 波点<br><a href="https://link.zhihu.com/?target=http%3A//www.airtightinteractive.com/demos/js/uberviz/wordproblems/" target="_blank" rel="noopener">ĂberViz</a> 电子<br>[A <a href="https://link.zhihu.com/?target=http%3A//www.nihilogic.dk/labs/canvas_music_visualization/" target="_blank" rel="noopener"> Radiohead</a>   音乐画画</p>
<p>=========物理特性元素============<br><a href="https://link.zhihu.com/?target=http%3A//hakim.se/experiments/html5/blob/03/" target="_blank" rel="noopener">Blob </a> 大水球<br><a href="https://link.zhihu.com/?target=http%3A//andrew-hoyer.com/experiments/cloth/" target="_blank" rel="noopener">Andrew Hoyer</a> 布-骨架<br><a href="https://link.zhihu.com/?target=http%3A//ie.microsoft.com/testdrive/Performance/FishBowl/" target="_blank" rel="noopener">HTML5 Fish Bowl</a> IE-鱼缸<br><a href="https://link.zhihu.com/?target=http%3A//webglsamples.googlecode.com/hg/aquarium/aquarium.html" target="_blank" rel="noopener">googlecode.com 的页面</a> chrome-水族馆<br><a href="https://link.zhihu.com/?target=http%3A//alteredqualia.com/three/examples/webgl_animals.html" target="_blank" rel="noopener">three.js webgl</a> 动物<br><a href="https://link.zhihu.com/?target=http%3A//www.spielzeugz.de/html5/liquid-particles-3D/" target="_blank" rel="noopener">Liquid Particles 3D</a> 3D粒子流</p>
<p>==========画绘与生成===========<br><a href="https://link.zhihu.com/?target=http%3A//www.queness.com/post/4650/10-jaw-dropping-html5-and-javascript-effects" target="_blank" rel="noopener">10 Jaw Dropping HTML5 and Javascript Effects</a>  10个画绘特效<br><a href="https://link.zhihu.com/?target=http%3A//html5-pro.com/wormz/" target="_blank" rel="noopener">wormz . html5 canvas experiment</a> 图片生成毛毛虫~~<br><a href="https://link.zhihu.com/?target=http%3A//weavesilk.com/" target="_blank" rel="noopener">Silk – Interactive Generative Art</a>  光效<br><a href="https://link.zhihu.com/?target=http%3A//sketchtoy.com/" target="_blank" rel="noopener">Sketch Toy: Draw sketches and share replays with friends!</a> 记录线稿步骤<br><a href="https://link.zhihu.com/?target=http%3A//asciiflow.com/" target="_blank" rel="noopener">ASCIIFlow Infinity</a> ASCII字符生成图表</p>
<p>========一些融入了HTML5的网站=======<br><a href="https://link.zhihu.com/?target=http%3A//andrevv.com/" target="_blank" rel="noopener">Andrew McCarthy</a>  滚动动物奔跑<br><a href="https://link.zhihu.com/?target=http%3A//tokyomildfoundation.com/" target="_blank" rel="noopener">http://tokyomildfoundation.com/</a>  东京温柔基金<br><a href="https://link.zhihu.com/?target=http%3A//www.fifty-five.com/" target="_blank" rel="noopener">fifty-five | the data agency</a>  垂直分割<br><a href="https://link.zhihu.com/?target=http%3A//aprilzero.com/" target="_blank" rel="noopener">A P R I L Z E R O</a>  数据分析<br><a href="https://link.zhihu.com/?target=http%3A//gamingmedia.ru/" target="_blank" rel="noopener">Gaming Media</a> 创意横向滚动<br><a href="https://link.zhihu.com/?target=http%3A//www.luxaqua-design.com/" target="_blank" rel="noopener">Luxaqua | Aquarium Design</a> 深邃海底纵向滚动<br><a href="https://link.zhihu.com/?target=http%3A//www.kilfish.com/" target="_blank" rel="noopener">KILFISH</a>  鬼畜纵向滚动<br><a href="https://link.zhihu.com/?target=http%3A//fullten-plums.com.tw/" target="_blank" rel="noopener">有顆梅，在台灣</a>  食品纵向滚动<br><a href="https://link.zhihu.com/?target=http%3A//www.vespillo-lefilm.com/" target="_blank" rel="noopener">Vespillo le film</a>  Vespillo纵向滚动<br><a href="https://link.zhihu.com/?target=http%3A//moonbear.animalsasia.org/ie/en/" target="_blank" rel="noopener">Exploring Moon Bears</a> IE-月熊志<br><a href="https://link.zhihu.com/?target=http%3A//metaljunkthegame.com/" target="_blank" rel="noopener">Metal Junk: The Game</a> HTML5游戏：金属废墟，游戏就不展开了~~</p>
<p>最近写的 基于 HTML5 的指南针和水平仪：<a href="https://link.zhihu.com/?target=http%3A//island205.github.io/H5Compass/" target="_blank" rel="noopener">H5Compass</a> iPhone 5s/5c 测试可用</p>
<p>最近看到一个惊艳的HTML5网站，<a href="https://link.zhihu.com/?target=http%3A//species-in-pieces.com/%23" target="_blank" rel="noopener">In Pieces - 30 Endangered Species, 30 Pieces.</a></p>
<p><a href="https://link.zhihu.com/?target=http%3A//tympanus.net/codrops/" target="_blank" rel="noopener">Codrops | Useful resources and inspiration for creative minds</a><br><a href="https://link.zhihu.com/?target=http%3A//tutorialzine.com/" target="_blank" rel="noopener">Tutorialzine</a><br>上面有很多的Demo，质量都很高，开源免费可商用</p>
<p>还有<a href="https://link.zhihu.com/?target=http%3A//codepen.io/" target="_blank" rel="noopener">CodePen - Front End Developer Playground &amp; Code Editor in the Browser</a>，像是前端界的github</p>
<p>3D立体书Codrops上有几个，不知道是不是你找的：<br><a href="https://link.zhihu.com/?target=http%3A//tympanus.net/Development/AnimatedBooks/index.html" target="_blank" rel="noopener">Animated Books with CSS 3D Transforms</a><br><a href="https://link.zhihu.com/?target=http%3A//tympanus.net/Tutorials/3DShadingWithBoxShadows/" target="_blank" rel="noopener">3D Shading with Box-Shadows</a><br><a href="https://link.zhihu.com/?target=http%3A//tympanus.net/Development/3DBookShowcase/index.html" target="_blank" rel="noopener">3D Book Showcase</a></p>
<p><a href="https://www.uisdc.com/10-best-free-animation-libraries" target="_blank" rel="noopener">https://www.uisdc.com/10-best-free-animation-libraries</a></p>
<h5 id="WOW-js-–-让页面滚动更有趣"><a href="#WOW-js-–-让页面滚动更有趣" class="headerlink" title="WOW.js – 让页面滚动更有趣"></a><a href="https://link.jianshu.com?t=https%3A%2F%2Fgithub.com%2Fmatthieua%2FWOW" target="_blank" rel="noopener">WOW.js – 让页面滚动更有趣</a></h5><p>使用说明：<a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.dowebok.com%2F131.html" target="_blank" rel="noopener">链接地址</a><br> 演示地址：<a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.dowebok.com%2Fdemo%2F131%2Findex2.html" target="_blank" rel="noopener">OW.js演示-oppo官网首页</a></p>
<h5 id="jQuery全屏滚动插件fullPage-js"><a href="#jQuery全屏滚动插件fullPage-js" class="headerlink" title="jQuery全屏滚动插件fullPage.js"></a><a href="https://link.jianshu.com?t=https%3A%2F%2Fgithub.com%2Falvarotrigo%2Ffullpage.js%2F" target="_blank" rel="noopener">jQuery全屏滚动插件<em>fullPage.js</em></a></h5><p>官网地址：<a href="https://link.jianshu.com?t=https%3A%2F%2Falvarotrigo.com%2FfullPage%2F" target="_blank" rel="noopener">链接地址</a><br> 使用说明：<a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.jq22.com%2Fjquery-info1124" target="_blank" rel="noopener">链接地址</a><br> 演示地址：<a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.jq22.com%2Fyanshi1124" target="_blank" rel="noopener">链接地址</a></p>
<h5 id="Animate-css-一款强大的预设css3动画库"><a href="#Animate-css-一款强大的预设css3动画库" class="headerlink" title="Animate.css 一款强大的预设css3动画库"></a><a href="https://link.jianshu.com?t=https%3A%2F%2Fgithub.com%2Fdaneden%2Fanimate.css" target="_blank" rel="noopener">Animate.css 一款强大的预设css3动画库</a></h5><p>官网地址：<a href="https://link.jianshu.com?t=https%3A%2F%2Fdaneden.github.io%2Fanimate.css%2F" target="_blank" rel="noopener">链接地址</a><br> 使用说明：<a href="https://link.jianshu.com?t=https%3A%2F%2Fwww.awesomes.cn%2Frepo%2Fdaneden%2Fanimate-css" target="_blank" rel="noopener">链接地址</a><br> 演示地址：<a href="https://link.jianshu.com?t=http%3A%2F%2Fwww.jq22.com%2Fyanshi819" target="_blank" rel="noopener">链接地址</a></p>
<p>Loading</p>
<p><a href="https://loading.io/" target="_blank" rel="noopener">https://loading.io/</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2017/09/19/HTML5 惊艳 demo/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2017/09/19/java 如何实现一个简单的RPC/">
                            Java 如何实现一个简单的RPC
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-09-19T15:42:24+08:00">
	
		    9月 19, 2017
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="Java-如何实现一个简单的RPC"><a href="#Java-如何实现一个简单的RPC" class="headerlink" title="Java 如何实现一个简单的RPC"></a>Java 如何实现一个简单的RPC</h1><p>###RPC的实现原理</p>
<p>正如上一讲所说，RPC主要是为了解决的两个问题：</p>
<ul>
<li>解决分布式系统中，服务之间的调用问题。</li>
<li>远程调用时，要能够像本地调用一样方便，让调用者感知不到远程调用的逻辑。</li>
</ul>
<p>还是以计算器Calculator为例，如果实现类CalculatorImpl是放在本地的，那么直接调用即可：</p>
<p><img src="https://file.mmdry.com/image/jpg/rpc1.png" alt="img"></p>
<p>现在系统变成分布式了，CalculatorImpl和调用方不在同一个地址空间，那么就必须要进行远程过程调用：</p>
<p><img src="https://file.mmdry.com/image/jpg/rpc2.png" alt="img"></p>
<p>那么如何实现远程过程调用，也就是RPC呢，一个完整的RPC流程，可以用下面这张图来描述：</p>
<p><img src="https://file.mmdry.com/image/jpg/rpc3.png" alt="img"></p>
<p>其中左边的Client，对应的就是前面的Service A，而右边的Server，对应的则是Service B。<br>下面一步一步详细解释一下。</p>
<ol>
<li>Service A的应用层代码中，调用了Calculator的一个实现类的add方法，希望执行一个加法运算；</li>
<li>这个Calculator实现类，内部并不是直接实现计算器的加减乘除逻辑，而是通过远程调用Service B的RPC接口，来获取运算结果，因此称之为<strong>Stub</strong>；</li>
<li>Stub怎么和Service B建立远程通讯呢？这时候就要用到<strong>远程通讯工具</strong>了，也就是图中的<strong>Run-time Library</strong>，这个工具将帮你实现远程通讯的功能，比如Java的<strong>Socket</strong>，就是这样一个库，当然，你也可以用基于Http协议的<strong>HttpClient</strong>，或者其他通讯工具类，都可以，<strong>RPC并没有规定说你要用何种协议进行通讯</strong>；</li>
<li>Stub通过调用通讯工具提供的方法，和Service B建立起了通讯，然后将请求数据发给Service B。需要注意的是，由于底层的网络通讯是基于<strong>二进制格式</strong>的，因此这里Stub传给通讯工具类的数据也必须是二进制，比如calculator.add(1,2)，你必须把参数值1和2放到一个Request对象里头（这个Request对象当然不只这些信息，还包括要调用哪个服务的哪个RPC接口等其他信息），然后<strong>序列化</strong>为二进制，再传给通讯工具类，这一点也将在下面的代码实现中体现；</li>
<li>二进制的数据传到Service B这一边了，Service B当然也有自己的通讯工具，通过这个通讯工具接收二进制的请求；</li>
<li>既然数据是二进制的，那么自然要进行<strong>反序列化</strong>了，将二进制的数据反序列化为请求对象，然后将这个请求对象交给Service B的Stub处理；</li>
<li>和之前的Service A的Stub一样，这里的Stub也同样是个“假玩意”，它所负责的，只是去解析请求对象，知道调用方要调的是哪个RPC接口，传进来的参数又是什么，然后再把这些参数传给对应的RPC接口，也就是Calculator的实际实现类去执行。很明显，如果是Java，那这里肯定用到了<strong>反射</strong>。</li>
<li>RPC接口执行完毕，返回执行结果，现在轮到Service B要把数据发给Service A了，怎么发？一样的道理，一样的流程，只是现在Service B变成了Client，Service A变成了Server而已：Service B反序列化执行结果-&gt;传输给Service A-&gt;Service A反序列化执行结果 -&gt; 将结果返回给Application，完毕。</li>
</ol>
<p>理论的讲完了，是时候把理论变成实践了。</p>
<p>###把理论变成实践</p>
<blockquote>
<p>本文的示例代码，可到<a href="https://github.com/hzy38324/simple-rpc" target="_blank" rel="noopener">Github</a>下载。</p>
</blockquote>
<p>首先是Client端的应用层怎么发起RPC，ComsumerApp：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComsumerApp</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Calculator calculator = <span class="keyword">new</span> CalculatorRemoteImpl();</span><br><span class="line">        <span class="keyword">int</span> result = calculator.add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>通过一个CalculatorRemoteImpl，我们把RPC的逻辑封装进去了，客户端调用时感知不到远程调用的麻烦</strong>。下面再来看看CalculatorRemoteImpl，代码有些多，但是其实就是把上面的2、3、4几个步骤用代码实现了而已，CalculatorRemoteImpl：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorRemoteImpl</span> <span class="keyword">implements</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; addressList = lookupProviders(<span class="string">"Calculator.add"</span>);</span><br><span class="line">        String address = chooseTarget(addressList);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Socket socket = <span class="keyword">new</span> Socket(address, PORT);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将请求序列化</span></span><br><span class="line">            CalculateRpcRequest calculateRpcRequest = generateRequest(a, b);</span><br><span class="line">            ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(socket.getOutputStream());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将请求发给服务提供方</span></span><br><span class="line">            objectOutputStream.writeObject(calculateRpcRequest);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将响应体反序列化</span></span><br><span class="line">            ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(socket.getInputStream());</span><br><span class="line">            Object response = objectInputStream.readObject();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (response <span class="keyword">instanceof</span> Integer) &#123;</span><br><span class="line">                <span class="keyword">return</span> (Integer) response;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> InternalError();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"fail"</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> InternalError();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>add方法的前面两行，lookupProviders和chooseTarget，可能大家会觉得不明觉厉。</p>
<p>分布式应用下，一个服务可能有多个实例，比如Service B，可能有ip地址为198.168.1.11和198.168.1.13两个实例，lookupProviders，其实就是在寻找要调用的服务的实例列表。在分布式应用下，通常会有一个<strong>服务注册中心</strong>，来提供查询实例列表的功能。</p>
<p>查到实例列表之后要调用哪一个实例呢，只时候就需要chooseTarget了，其实内部就是一个<strong>负载均衡</strong>策略。</p>
<p>由于我们这里只是想实现一个简单的RPC，所以暂时不考虑服务注册中心和负载均衡，因此代码里写死了返回ip地址为127.0.0.1。</p>
<p>代码继续往下走，我们这里用到了Socket来进行远程通讯，同时利用<strong>ObjectOutputStream</strong>的writeObject和<strong>ObjectInputStream</strong>的readObject，来实现序列化和反序列化。</p>
<p>最后再来看看Server端的实现，和Client端非常类似，ProviderApp：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProviderApp</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Calculator calculator = <span class="keyword">new</span> CalculatorImpl();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> ProviderApp().run();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ServerSocket listener = <span class="keyword">new</span> ServerSocket(<span class="number">9090</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                Socket socket = listener.accept();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 将请求反序列化</span></span><br><span class="line">                    ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(socket.getInputStream());</span><br><span class="line">                    Object object = objectInputStream.readObject();</span><br><span class="line"></span><br><span class="line">                    log.info(<span class="string">"request is &#123;&#125;"</span>, object);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 调用服务</span></span><br><span class="line">                    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">if</span> (object <span class="keyword">instanceof</span> CalculateRpcRequest) &#123;</span><br><span class="line">                        CalculateRpcRequest calculateRpcRequest = (CalculateRpcRequest) object;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="string">"add"</span>.equals(calculateRpcRequest.getMethod())) &#123;</span><br><span class="line">                            result = calculator.add(calculateRpcRequest.getA(), calculateRpcRequest.getB());</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 返回结果</span></span><br><span class="line">                    ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(socket.getOutputStream());</span><br><span class="line">                    objectOutputStream.writeObject(<span class="keyword">new</span> Integer(result));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    log.error(<span class="string">"fail"</span>, e);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    socket.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            listener.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Server端主要是通过ServerSocket的accept方法，来接收Client端的请求，接着就是反序列化请求-&gt;执行-&gt;序列化执行结果，最后将二进制格式的执行结果返回给Client。</p>
<p><strong>就这样我们实现了一个简陋而又详细的RPC。</strong><br>说它简陋，是因为这个实现确实比较挫，在下一小节会说它为什么挫。<br>说它详细，是因为它一步一步的演示了一个RPC的执行流程，方便大家了解RPC的内部机制。</p>
<p>###为什么说这个RPC实现很挫</p>
<p>这个RPC实现只是为了给大家演示一下RPC的原理，要是想放到生产环境去用，那是绝对不行的。</p>
<p>1、缺乏通用性<br>我通过给Calculator接口写了一个CalculatorRemoteImpl，来实现计算器的远程调用，下一次要是有别的接口需要远程调用，是不是又得再写对应的远程调用实现类？这肯定是很不方便的。</p>
<p>那该如何解决呢？先来看看使用Dubbo时是如何实现RPC调用的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Reference</span></span><br><span class="line"><span class="keyword">private</span> Calculator calculator;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">calculator.add(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Dubbo通过和Spring的集成，在Spring容器初始化的时候，如果扫描到对象加了@Reference注解，那么就给这个对象生成一个代理对象，这个代理对象会负责远程通讯，然后将代理对象放进容器中。所以代码运行期用到的calculator就是那个代理对象了。</p>
<p>我们可以先不和Spring集成，也就是先不采用依赖注入，但是我们要做到像Dubbo一样，无需自己手动写代理对象，怎么做呢？那自然是要求所有的远程调用都遵循一套模板，<strong>把远程调用的信息放到一个RpcRequest对象里面，发给Server端，Server端解析之后就知道你要调用的是哪个RPC接口、以及入参是什么类型、入参的值又是什么</strong>，就像Dubbo的RpcInvocation：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RpcInvocation</span> <span class="keyword">implements</span> <span class="title">Invocation</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">4355285085441097045L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String methodName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Class&lt;?&gt;[] parameterTypes;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object[] arguments;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; attachments;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> Invoker&lt;?&gt; invoker;</span><br></pre></td></tr></table></figure>
<p>2、集成Spring<br>在实现了代理对象通用化之后，下一步就可以考虑集成Spring的IOC功能了，通过Spring来创建代理对象，这一点就需要对Spring的bean初始化有一定掌握了。</p>
<p>3、长连接or短连接<br>总不能每次要调用RPC接口时都去开启一个Socket建立连接吧？是不是可以保持若干个长连接，然后每次有rpc请求时，把请求放到任务队列中，然后由线程池去消费执行？只是一个思路，后续可以参考一下Dubbo是如何实现的。</p>
<p>4、 服务端线程池<br>我们现在的Server端，是单线程的，每次都要等一个请求处理完，才能去accept另一个socket的连接，这样性能肯定很差，是不是可以通过一个线程池，来实现同时处理多个RPC请求？同样只是一个思路。</p>
<p>5、服务注册中心<br>正如之前提到的，要调用服务，首先你需要一个服务注册中心，告诉你对方服务都有哪些实例。Dubbo的服务注册中心是可以配置的，官方推荐使用Zookeeper。如果使用Zookeeper的话，要怎样往上面注册实例，又要怎样获取实例，这些都是要实现的。</p>
<p>6、负载均衡<br>如何从多个实例里挑选一个出来，进行调用，这就要用到负载均衡了。负载均衡的策略肯定不只一种，要怎样把策略做成可配置的？又要如何实现这些策略？同样可以参考Dubbo，<a href="http://dubbo.apache.org/zh-cn/docs/user/quick-start.html" target="_blank" rel="noopener">Dubbo - 负载均衡</a></p>
<p>7、结果缓存<br>每次调用查询接口时都要真的去Server端查询吗？是不是要考虑一下支持缓存？</p>
<p>8、多版本控制<br>服务端接口修改了，旧的接口怎么办？</p>
<p>9、异步调用<br>客户端调用完接口之后，不想等待服务端返回，想去干点别的事，可以支持不？</p>
<p>10、优雅停机<br>服务端要停机了，还没处理完的请求，怎么办？</p>
<p>……</p>
<p>诸如此类的优化点还有很多，这也是为什么实现一个高性能高可用的RPC框架那么难的原因。</p>
<p>当然，我们现在已经有很多很不错的RPC框架可以参考了，我们完全可以借鉴一下前人的智慧。</p>
<p>###参考</p>
<ul>
<li>一本很棒的分布式书籍：《大型网站系统与Java中间件实践》</li>
<li><a href="http://dubbo.apache.org/zh-cn/docs/user/quick-start.html" target="_blank" rel="noopener">Dubbo 使用文档</a></li>
<li><a href="http://dubbo.apache.org/zh-cn/docs/user/quick-start.html" target="_blank" rel="noopener">Dubbo 源码开发手册</a></li>
</ul>

                    
                        

                    
                    
                        <p>
                            <a href="/2017/09/19/java 如何实现一个简单的RPC/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2017/09/12/scrapy/">
                            scrapy
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-09-12T10:10:38+08:00">
	
		    9月 12, 2017
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    
                    
                        

                    
                    
                        <p>
                            <a href="/2017/09/12/scrapy/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2017/09/08/pypi-server/">
                            pypi私有服务器
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-09-08T18:57:18+08:00">
	
		    9月 08, 2017
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="pypi-server搭建"><a href="#pypi-server搭建" class="headerlink" title="pypi-server搭建"></a>pypi-server搭建</h2><h3 id="pypi官方说明"><a href="#pypi官方说明" class="headerlink" title="pypi官方说明"></a><a href="http://wiki.python.org/moin/PyPiImplementations" target="_blank" rel="noopener">pypi官方说明</a></h3><h3 id="1-基础安装和启动"><a href="#1-基础安装和启动" class="headerlink" title="1.基础安装和启动"></a>1.基础安装和启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ pip install pypiserver</span><br><span class="line">$ mkdir ~/pypi/packages</span><br><span class="line"># copy some source packages or eggs to this directory</span><br><span class="line">$ pypi-server -p 3141 ~/pypi/packages</span><br><span class="line">$ pip install -i http://localhost:8001/simple/ ...</span><br></pre></td></tr></table></figure>
<h3 id="2-添加上传密码"><a href="#2-添加上传密码" class="headerlink" title="2.添加上传密码"></a>2.添加上传密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ pip install passlib</span><br><span class="line">$ apt-get install apache2-utils     # Mac OS不用安装</span><br><span class="line">$ htpasswd -sc ~/pypi/.htaccess user   # 回车后会提示输入密码，输入123</span><br></pre></td></tr></table></figure>
<h3 id="3-启动pypi-server时加载密钥文件"><a href="#3-启动pypi-server时加载密钥文件" class="headerlink" title="3.启动pypi server时加载密钥文件"></a>3.启动pypi server时加载密钥文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pypi-server -p 3141 -P ~/pypi/.htaccess ./packages</span><br></pre></td></tr></table></figure>
<h3 id="4-在用户根目录下创建-pypirc文件"><a href="#4-在用户根目录下创建-pypirc文件" class="headerlink" title="4.在用户根目录下创建.pypirc文件"></a>4.在用户根目录下创建.pypirc文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[distutils]</span><br><span class="line">index-servers =</span><br><span class="line">  privatepypi</span><br><span class="line"></span><br><span class="line">[privatepypi]</span><br><span class="line">repository:http://127.0.0.1:3141</span><br><span class="line">username:user</span><br><span class="line">password:123</span><br></pre></td></tr></table></figure>
<h3 id="5-上传package"><a href="#5-上传package" class="headerlink" title="5.上传package"></a>5.上传package</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py sdist upload -r privatepypi</span><br></pre></td></tr></table></figure>
<h3 id="6-下载package"><a href="#6-下载package" class="headerlink" title="6.下载package"></a>6.下载package</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install -i http://localhost:3134/simple/ package-name</span><br></pre></td></tr></table></figure>
<h3 id="7-setup-py文件示例"><a href="#7-setup-py文件示例" class="headerlink" title="7.setup.py文件示例"></a>7.setup.py文件示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import importlib</span><br><span class="line">from setuptools import setup, find_packages</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PROJECT = &apos;libs&apos;</span><br><span class="line">requires = []</span><br><span class="line"># 读取requirements.txt文件，获得需要安装基础包</span><br><span class="line">with open(&apos;requirements.txt&apos;) as f:</span><br><span class="line">    for line in f.readlines():</span><br><span class="line">        requires.append(line.strip())</span><br><span class="line"></span><br><span class="line"># 打包时替换version.py文件</span><br><span class="line">if sys.argv[1] == &apos;sdist&apos;:</span><br><span class="line">    version_py = importlib.import_module(&apos;&#123;project&#125;.version&apos;.format(project=PROJECT))</span><br><span class="line">    version_py.update_version_file(&apos;&#123;project&#125;/version.py&apos;.format(project=PROJECT))</span><br><span class="line"># reload version模块，确保在替换version.py文件后获得最新的version号</span><br><span class="line">version = reload(importlib.import_module(&apos;&#123;pro&#125;.version&apos;.format(pro=PROJECT))).get_version()</span><br><span class="line"></span><br><span class="line">with open(&apos;README.md&apos;, &apos;r&apos;) as f:</span><br><span class="line">    readme = f.read()</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=&apos;libs&apos;,</span><br><span class="line">    version=version,</span><br><span class="line">    description=&apos;libs is the common lib for Django project&apos;,</span><br><span class="line">    long_description=readme,</span><br><span class="line">    author=&apos;xxx&apos;,</span><br><span class="line">    author_email=&apos;xxx@gmail.com&apos;,</span><br><span class="line">    url=&apos;&apos;,</span><br><span class="line">    packages=find_packages(),</span><br><span class="line">    include_package_data=True,</span><br><span class="line">    install_requires=requires,</span><br><span class="line">    test_suite=&apos;nose.collector&apos;,</span><br><span class="line">    license=&apos;All rights reserved by xxx.&apos;,</span><br><span class="line">    zip_safe=False,</span><br><span class="line">    classifiers=(</span><br><span class="line">        &apos;Development Status :: 5 - Production/Stable&apos;,</span><br><span class="line">        &apos;Intended Audience :: Developers&apos;,</span><br><span class="line">        &apos;Natural Language :: English&apos;,</span><br><span class="line">        &apos;Programming Language :: Python&apos;,</span><br><span class="line">        &apos;Programming Language :: Python :: 2.7&apos;,</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="setup-py官方文档"><a href="#setup-py官方文档" class="headerlink" title="setup.py官方文档"></a><a href="https://docs.python.org/2/distutils/setupscript.html" target="_blank" rel="noopener">setup.py官方文档</a></h3><h2 id="使用supervisor管理pypi-server"><a href="#使用supervisor管理pypi-server" class="headerlink" title="使用supervisor管理pypi-server"></a>使用supervisor管理pypi-server</h2><h3 id="1-生成run-pypi-sh文件，supervisor执行命令文件"><a href="#1-生成run-pypi-sh文件，supervisor执行命令文件" class="headerlink" title="1.生成run-pypi.sh文件，supervisor执行命令文件"></a>1.生成run-pypi.sh文件，supervisor执行命令文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"># 启动virtualenv</span><br><span class="line">. ~/pypi/pypienv/bin/activate</span><br><span class="line">exec pypi-server -p 3141 ~/pypi/packages</span><br></pre></td></tr></table></figure>
<h3 id="2-生成supervisor配置文件，-etc-supervisor-conf-d-pypi-server-conf"><a href="#2-生成supervisor配置文件，-etc-supervisor-conf-d-pypi-server-conf" class="headerlink" title="2.生成supervisor配置文件，/etc/supervisor/conf.d/pypi-server.conf"></a>2.生成supervisor配置文件，/etc/supervisor/conf.d/pypi-server.conf</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[program:pypi-server]</span><br><span class="line">  directory=~/pypi/</span><br><span class="line">  command=sh run-pypi.sh</span><br><span class="line">  autostart=true</span><br><span class="line">  autorestart=true</span><br><span class="line">  redirect_stderr=true</span><br></pre></td></tr></table></figure>
<h3 id="3-启动和停止supervisor"><a href="#3-启动和停止supervisor" class="headerlink" title="3.启动和停止supervisor"></a>3.启动和停止supervisor</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo /etc/init.d/supervisor start</span><br><span class="line">$ sudo /etc/init.d/supervisor stop</span><br></pre></td></tr></table></figure>
<h2 id="公有云pypi"><a href="#公有云pypi" class="headerlink" title="公有云pypi"></a>公有云pypi</h2><h3 id="1-将包的相关信息-根据PyPI账户的注册信息-在PyPI主页上注册。"><a href="#1-将包的相关信息-根据PyPI账户的注册信息-在PyPI主页上注册。" class="headerlink" title="1.将包的相关信息, 根据PyPI账户的注册信息, 在PyPI主页上注册。"></a>1.将包的相关信息, 根据PyPI账户的注册信息, 在PyPI主页上注册。</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python setup.py register -r pypi</span><br></pre></td></tr></table></figure>
<h3 id="2-将包的源代码内容打包上传。"><a href="#2-将包的源代码内容打包上传。" class="headerlink" title="2.将包的源代码内容打包上传。"></a>2.将包的源代码内容打包上传。</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python setup.py sdist upload -r pypi</span><br></pre></td></tr></table></figure>

                    
                        

                    
                    
                        <p>
                            <a href="/2017/09/08/pypi-server/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2017/09/08/gitlib-runner/">
                            gitlib-runner
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2017-09-08T17:26:17+08:00">
	
		    9月 08, 2017
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h3 id="1-使用docker运行gitlab-runner"><a href="#1-使用docker运行gitlab-runner" class="headerlink" title="1.使用docker运行gitlab-runner"></a>1.使用docker运行gitlab-runner</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gitlab-runner:</span><br><span class="line">    container_name: gitlab-runner</span><br><span class="line">    image: gitlab/gitlab-runner:latest</span><br><span class="line">    restart: always</span><br><span class="line">    volumes:</span><br><span class="line">        - /etc/localtime:/etc/localtime</span><br><span class="line">        - /home/data/docker/gitlab-runner/home/.pypirc:/root/.pypirc</span><br><span class="line">        - /var/run/docker.sock:/var/run/docker.sock</span><br><span class="line">        - /home/data/docker/gitlab-runner/config:/etc/gitlab-runner</span><br><span class="line">    command: [run, --working-directory=/home/gitlab-runner]</span><br><span class="line">    dns:</span><br><span class="line">        - 192.168.0.100</span><br></pre></td></tr></table></figure>
<h3 id="2-进入docker"><a href="#2-进入docker" class="headerlink" title="2.进入docker"></a>2.进入docker</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker exec -it gitlab-runner bash</span><br></pre></td></tr></table></figure>
<h3 id="3-执行gitlab-runner或gitlab-ci-multi-runner-reigster"><a href="#3-执行gitlab-runner或gitlab-ci-multi-runner-reigster" class="headerlink" title="3.执行gitlab-runner或gitlab-ci-multi-runner reigster"></a>3.执行gitlab-runner或gitlab-ci-multi-runner reigster</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ sudo gitlab-runner register</span><br><span class="line"></span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com )</span><br><span class="line">## 输入gitlab地址</span><br><span class="line">Please enter the gitlab-ci token for this runner</span><br><span class="line">## gitlab的token(在gitlab的Admin Area中) 或者仓库的token(仓库-&gt;设置-&gt;Runner)</span><br><span class="line">Please enter the gitlab-ci description for this runner</span><br><span class="line">## Runner描述信息</span><br><span class="line">Please enter the gitlab-ci tags for this runner (comma separated):</span><br><span class="line">## Runner的标签 可以指定仓库，之后在.gitlab-ci.yml中配置相对应tags </span><br><span class="line">Please enter the executor: parallels, shell, ssh, virtualbox, docker+machine, docker-ssh+machine, docker, docker-ssh, kubernetes:</span><br><span class="line">docker  ## 执行类型 </span><br><span class="line">Please enter the Docker image (eg. ruby:2.1):</span><br><span class="line">build-image  ## 编译环境的镜像</span><br><span class="line">Runner registered successfully. Feel free to start it, but if it&apos;s running already the config should be automatically reloaded!</span><br></pre></td></tr></table></figure>
<p>注册runner执行类型有多种方式，具体参考：<a href="https://docs.gitlab.com/ce/ci/docker/using_docker_build.html" target="_blank" rel="noopener">Using Docker Build</a></p>
<h3 id="4-查看已经注册的runner"><a href="#4-查看已经注册的runner" class="headerlink" title="4.查看已经注册的runner"></a>4.查看已经注册的runner</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gitlab-runner list</span><br><span class="line">Listing configured runners                          ConfigFile=/mypath/.gitlab-runner/config.toml</span><br></pre></td></tr></table></figure>
<h3 id="5-配置-gitlab-ci-yml"><a href="#5-配置-gitlab-ci-yml" class="headerlink" title="5.配置.gitlab-ci.yml"></a>5.配置.gitlab-ci.yml</h3><p>详情参考：<a href="https://docs.gitlab.com/ce/ci/yaml/README.html" target="_blank" rel="noopener">gitlab-ci说明文档</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2017/09/08/gitlib-runner/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">第 1 页 共 1 页</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2019 Xiangjy. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/dx.png" alt="作者的图片">
        
            <h4 id="about-card-name">Xiangjy</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-dbd16rvloemmuxdzniplmnxxvwoz24eya9wol0b7vvmlokgqsjivmb8dnscy.min.js"></script>
<!--SCRIPTS END--><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->



    </body>
</html>
